<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®å¯¼å…¥ - ä½“è‚²æ•™å¸ˆåŠ©æ‰‹</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .progress-wrap {
            display: none; margin-top: 12px;
            background: #f0f0f0; border-radius: 8px; overflow: hidden; height: 20px;
        }
        .progress-bar {
            height: 100%; width: 0; background: #4a90e2;
            transition: width 0.3s ease; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; color: #fff; white-space: nowrap;
        }
        .progress-label { font-size: 13px; color: #555; margin-top: 6px; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; padding: 12px 16px; border-radius: 6px; margin-bottom: 16px; }
        .alert-error   { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; padding: 12px 16px; border-radius: 6px; margin-bottom: 16px; white-space: pre-line; }
        .import-form { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
    </style>
</head>
<body>
<nav class="navbar">
    <div class="nav-brand">ğŸƒ ä½“è‚²æ•™å¸ˆåŠ©æ‰‹</div>
    <div class="nav-links">
        <a th:href="@{/admin}">ç®¡ç†åå°</a>
        <a th:href="@{/dashboard}">é¦–é¡µ</a>
        <span class="nav-user" th:if="${currentSchool != null}" th:text="${currentSchool.name}"></span>
        <form th:action="@{/logout}" method="post" style="display:inline">
            <button type="submit" class="btn-link">é€€å‡º</button>
        </form>
    </div>
</nav>
<div class="container">
    <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
    <div th:if="${error}"   class="alert alert-error"   th:text="${error}"></div>
    <div class="page-header"><h2>æ•°æ®å¯¼å…¥</h2></div>

    <!-- ç­çº§å¯¼å…¥ -->
    <div class="card">
        <h3>æ‰¹é‡å¯¼å…¥ç­çº§</h3>
        <p class="text-muted">Excelæ ¼å¼ï¼ˆ.xlsxï¼‰ï¼Œç¬¬ä¸€è¡Œä¸ºè¡¨å¤´ï¼šç­çº§åç§°ã€ç±»å‹ï¼ˆè¡Œæ”¿ç­/é€‰ä¿®è¯¾ï¼‰ã€å¹´çº§ï¼ˆé€‰ä¿®è¯¾å¯ç•™ç©ºï¼‰</p>
        <p><a th:href="@{/admin/import/template/classes}" class="btn btn-secondary">ä¸‹è½½ç­çº§å¯¼å…¥æ¨¡æ¿</a></p>
        <form th:action="@{/admin/import/classes}" method="post" enctype="multipart/form-data"
              class="import-form" onsubmit="startProgress(this)">
            <input type="file" name="file" accept=".xlsx" required>
            <button type="submit" class="btn btn-primary">å¯¼å…¥</button>
        </form>
        <div class="progress-wrap" id="prog-classes">
            <div class="progress-bar" id="bar-classes">0%</div>
        </div>
        <div class="progress-label" id="label-classes"></div>
    </div>

    <!-- å­¦ç”Ÿå¯¼å…¥ -->
    <div class="card">
        <h3>æ‰¹é‡å¯¼å…¥å­¦ç”Ÿ</h3>
        <p class="text-muted">Excelæ ¼å¼ï¼ˆ.xlsxï¼‰ï¼Œç¬¬ä¸€è¡Œä¸ºè¡¨å¤´ï¼šå¹´çº§ã€ç­çº§ã€å§“åã€æ€§åˆ«ã€å­¦å·ã€èº«ä»½è¯å·ã€é€‰ä¿®è¯¾</p>
        <p><a th:href="@{/admin/import/template/students}" class="btn btn-secondary">ä¸‹è½½å­¦ç”Ÿå¯¼å…¥æ¨¡æ¿</a></p>
        <form th:action="@{/admin/import/students}" method="post" enctype="multipart/form-data"
              class="import-form" onsubmit="startProgress(this)">
            <input type="file" name="file" accept=".xlsx" required>
            <button type="submit" class="btn btn-primary">å¯¼å…¥</button>
        </form>
        <div class="progress-wrap" id="prog-students">
            <div class="progress-bar" id="bar-students">0%</div>
        </div>
        <div class="progress-label" id="label-students"></div>
    </div>

    <!-- æ•™å¸ˆå¯¼å…¥ -->
    <div class="card">
        <h3>æ‰¹é‡å¯¼å…¥æ•™å¸ˆ</h3>
        <p class="text-muted">Excelæ ¼å¼ï¼ˆ.xlsxï¼‰ï¼Œç¬¬ä¸€è¡Œä¸ºè¡¨å¤´ï¼šå§“åã€æ‰‹æœºå·ã€å¯†ç ï¼ˆå¯é€‰ï¼Œé»˜è®¤123456ï¼‰ã€è¡Œæ”¿ç­ï¼ˆå¯é€‰ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”ï¼‰ã€é€‰ä¿®è¯¾ï¼ˆå¯é€‰ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”ï¼‰ã€‚ç”¨æˆ·åé»˜è®¤ä¸ºæ‰‹æœºå·ã€‚</p>
        <p><a th:href="@{/admin/import/template/teachers}" class="btn btn-secondary">ä¸‹è½½æ•™å¸ˆå¯¼å…¥æ¨¡æ¿</a></p>
        <form th:action="@{/admin/import/teachers}" method="post" enctype="multipart/form-data"
              class="import-form" onsubmit="startProgress(this)">
            <input type="file" name="file" accept=".xlsx" required>
            <button type="submit" class="btn btn-primary">å¯¼å…¥</button>
        </form>
        <div class="progress-wrap" id="prog-teachers">
            <div class="progress-bar" id="bar-teachers">0%</div>
        </div>
        <div class="progress-label" id="label-teachers"></div>
    </div>
    <!-- é€‰ä¿®è¯¾æ‰¹é‡ä¿®æ”¹ -->
    <div class="card">
        <h3>æ‰¹é‡ä¿®æ”¹å­¦ç”Ÿé€‰ä¿®è¯¾</h3>
        <p class="text-muted">Excelæ ¼å¼ï¼ˆ.xlsxï¼‰ï¼Œç¬¬ä¸€è¡Œä¸ºè¡¨å¤´ï¼šå­¦å·ã€é€‰ä¿®è¯¾ã€‚æŒ‰å­¦å·åŒ¹é…å­¦ç”Ÿï¼Œè¦†ç›–å…¶é€‰ä¿®è¯¾å­—æ®µï¼›é€‰ä¿®è¯¾ç•™ç©ºåˆ™æ¸…é™¤ã€‚</p>
        <p><a th:href="@{/admin/import/template/elective}" class="btn btn-secondary">ä¸‹è½½æ¨¡æ¿</a></p>
        <form th:action="@{/admin/import/elective}" method="post" enctype="multipart/form-data"
              class="import-form" onsubmit="startProgress(this)">
            <input type="file" name="file" accept=".xlsx" required>
            <button type="submit" class="btn btn-primary">å¯¼å…¥</button>
        </form>
        <div class="progress-wrap" id="prog-elective">
            <div class="progress-bar" id="bar-elective">0%</div>
        </div>
        <div class="progress-label" id="label-elective"></div>
    </div>

</div>
<script>
function startProgress(form) {
    // æ‰¾åˆ°å¯¹åº”çš„è¿›åº¦æ¡
    const card = form.closest('.card');
    const wrap = card.querySelector('.progress-wrap');
    const bar  = card.querySelector('.progress-bar');
    const label = card.querySelector('.progress-label');

    wrap.style.display = 'block';
    label.textContent = 'æ­£åœ¨ä¸Šä¼ å¹¶å¤„ç†ï¼Œè¯·ç¨å€™...';

    let pct = 0;
    const interval = setInterval(() => {
        // æ¨¡æ‹Ÿè¿›åº¦ï¼šå¿«é€Ÿåˆ° 90%ï¼Œä¹‹åç­‰å¾…æœåŠ¡å™¨å“åº”
        if (pct < 90) {
            pct += Math.random() * 8;
            if (pct > 90) pct = 90;
        }
        bar.style.width = pct.toFixed(0) + '%';
        bar.textContent = pct.toFixed(0) + '%';
    }, 200);

    // é¡µé¢è·³è½¬æ—¶æ¸…é™¤å®šæ—¶å™¨ï¼ˆæœåŠ¡å™¨è¿”å›åæµè§ˆå™¨ä¼šè·³è½¬ï¼‰
    window.addEventListener('beforeunload', () => {
        clearInterval(interval);
        bar.style.width = '100%';
        bar.textContent = '100%';
    });
}
</script>
<footer class="site-footer">
    <th:block th:replace="~{fragments/footer :: version}"></th:block>
    <span class="footer-sep">|</span>
    <span>Â© 2026 é™ˆèƒœæ¾ ç‰ˆæƒæ‰€æœ‰</span>
</footer>
</body>
</html>
